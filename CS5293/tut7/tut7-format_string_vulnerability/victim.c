#include <stdio.h>
#include <stdlib.h>

int target_3 = 0x30;

int fmtstr()
{
    char input[1000];
    int target_1 = 0x10;

    // char shellcode[] = "\x6a\x68\x68\x2f\x2f\x2f\x73\x68\x2f\x62\x69\x6e\x89\xe3\x68\x01\x01\x01\x01\x81\x34\x24\x72\x69\x01\x01\x31\xc9\x51\x6a\x04\x59\x01\xe1\x51\x89\xe1\x31\xd2\x6a\x0b\x58\xcd\x80";

    // useful info for experiments
    printf("Address of target_1: %p\n", &target_1);
    // printf("Address of shellcode: %p\n", &shellcode);
    printf("Value of target_1 (old): 0x%x\n", target_1);

    printf("Please enter a string:\n");
    fgets(input, sizeof(input) - 1, stdin);
    printf("Value of input (new): %s\n", input);

    // vulnerable call of printf
    printf(input);
    printf("\n");

    // check if value of target_1 is changed
    printf("Value of target_1 (new): 0x%x\n", target_1);
    return 1;
}

int main()
{
    int target_2 = 0x20;
    int *target_4 = (int *)malloc(2 * sizeof(int));
    target_4[0] = 0x40;
    target_4[1] = 0x41;

    printf("(Optional) Old values of target_2, target_3, target_4[0], target_4[1] are: 0x%x, 0x%x, 0x%x, 0x%x\n", target_2, target_3, target_4[0], target_4[1]);
    // useful info for experiments
    printf("(Optional) Addresses of target_2, target_3, target_4[0], target_4[1] are: | %p | %p | %p | %p |\n", &target_2, &target_3, target_4, target_4 + 1);

    fmtstr();

    printf("(Optional) New values of target_2, target_3, target_4[0], target_4[1] are: 0x%x, 0x%x, 0x%x, 0x%x\n", target_2, target_3, target_4[0], target_4[1]);
    free(target_4);
    printf("Return successful");
    return 1;
}